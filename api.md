# Ledger System API Documentation

All API endpoints (except `/health`) are prefixed with `/api/v1` and require an API key via the `X-API-Key` header.

---

## 🔐 Authentication

All requests (except `/health`) must include:

```
X-API-Key: your-api-key
```

Replace `your-api-key` with the value from your `.env` (`API_KEY=...`).

---

## 🟢 Health Check

### `GET /health`

- ✅ No API key required.
- 🩺 Returns service status.

#### Response

```
OK
```

---

## 👤 Users

### `POST /api/v1/users`

- 🛡️ Requires `X-API-Key`
- 🛡️ Requires `Content-Type: application/json`
- 📄 Creates a new user

#### Request

```json
{
  "name": "Alice Ledger",
  "email": "alice@example.com"
}
```

#### Response (201 Created)

```json
{
  "id": 1
}
```

---

## 💸 Transactions

### `POST /api/v1/transactions/deposit`

- 🛡️ Requires `X-API-Key`
- 🛡️ Requires `Content-Type: application/json`
- 💰 Deposit funds into a user account

#### Request

```json
{
  "user_id": 1,
  "amount": 2.5,
  "currency": "ETH"
}
```

#### Response (201 Created)

```json
{
  "id": "uuid"
}
```

---

### `POST /api/v1/transactions/withdraw`

- 🛡️ Requires `X-API-Key`
- 🛡️ Requires `Content-Type: application/json`
- 💸 Withdraw funds from a user account

#### Request

```json
{
  "user_id": 1,
  "amount": 1.0,
  "currency": "ETH"
}
```

#### Response (201 Created)

```json
{
  "id": "uuid"
}
```

---

### `POST /api/v1/transactions/transfer`

- 🛡️ Requires `X-API-Key`
- 🛡️ Requires `Content-Type: application/json`
- 🔁 Transfer funds between users

#### Request

```json
{
  "from_user_id": 1,
  "to_user_id": 2,
  "amount": 0.5,
  "currency": "ETH"
}
```

#### Response (201 Created)

```json
{
  "id": "uuid"
}
```

---

### `GET /api/v1/users/{userId}/balances`
### `GET /api/v1/users/{userId}/balances?currency=ETH`

- 🛡️ Requires `X-API-Key`
- 🛡️ Requires `Content-Type: application/json`
- 📊 Get user balances, optionally filtered by currency

#### Response

```json
[
  {
    "currency": "ETH",
    "balance": 1.5
  },
  {
    "currency": "USDC",
    "balance": 100.0
  }
]
```

---

## ⛓️ Blockchain Integration Endpoints

### `POST /api/v1/addresses`

- 🛡️ Requires `X-API-Key`
- 🛡️ Requires `Content-Type: application/json`
- 🔗 Register a blockchain address to monitor

#### Request

```json
{
  "user_id": 1,
  "chain": "ethereum",
  "address": "0xabc123..."
}
```

#### Response (201 Created)

```json
{
  "id": 1,
  "user_id": 1,
  "chain": "ethereum",
  "address": "0xabc123..."
}
```

---

### `GET /api/v1/addresses/{address}/transactions`

- 🛡️ Requires `X-API-Key`
- 🛡️ Requires `Content-Type: application/json`
- 📜 Get on-chain transactions for a registered address

#### Response

```json
[
  {
    "id": "uuid",
    "address": "0xabc123...",
    "tx_hash": "0xdef456...",
    "amount": 1.2,
    "currency": "ETH",
    "direction": "credit",
    "block_height": 22961998,
    "confirmed": true,
    "created_at": "2025-07-20T00:00:00Z"
  }
]
```

---

### `GET /api/v1/addresses/{address}/balance`

- 🛡️ Requires `X-API-Key`
- 🛡️ Requires `Content-Type: application/json`
- 📈 Get on-chain balance for a registered address

#### Response

```json
{
  "address": "0xabc123...",
  "currency": "ETH",
  "balance": 4.3,
  "last_updated": "2025-07-20T00:00:00Z"
}
```

---

## 🔄 Reconciliation

### `POST /api/v1/reconciliation`

- 🛡️ Requires `X-API-Key`
- 🛡️ Requires `Content-Type: application/json`
- 🔄 Reconcile on-chain balances with ledger entries

#### Response

```json
{
  "status": "ok",
  "reconciled_entries": 5
}
```

---

## 🧪 Sample API Request with Curl

```sh
curl -X POST http://localhost:8080/api/v1/users \
  -H "Content-Type: application/json" \
  -H "X-API-Key: your-api-key" \
  -d '{"name":"Alice","email":"alice@example.com"}'
```

---

## 🧩 Notes

- UUIDs are generated by the server.
- Ensure user addresses are stored before on-chain matching can occur.
- Timestamps are in RFC3339 UTC format.
- Currency values are floats (ETH, USDC, etc.).